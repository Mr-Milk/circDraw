{% extends "base.html" %}

{% load static %}

{% block content %}

<!-- No container -->
<section id="tools">
    <div class="container-fluid">
        <div class="row ">
            <div class="col-sm-2">
                <nav id="toc" class="sticky-top" style="padding-top: 105px;">

                </nav>
            </div>
            <div class="col-sm-10 text-center">

                <h2 id="report">Basic Report</h2>
                <h3 id="len">circRNA length</h3>
                <div id="lenChart" style="width:1000px;height:500px"></div>
                <h3 id="exon">circRNA length</h3>
                <div id="exonChart" style="width:500px;height:500px"></div>
                <h3 id="iso">circRNA length</h3>
                <div id="isoChart" style="width:500px;height:500px"></div>
                <div id="biocircos"></div>
                <h2 id="density" data-toc-text="Density plot">circRNA density distribution on chromosome</h2>
                <div class="loader svg" id="load">
                    <img src='../../../media/dna.gif' class="dna">
                </div>
                <svg id="svg2" width="800" height="500" class="svg"></svg>
                <div class="row justify-content-center mt-3">
                    <div class="col-2">
                        <p class="mt-3">Set density limit: </p>
                    </div>
                        <div class="col-6 range-slider">
                                <input id="den-selector" type="text" class="js-range-slider" value="" />
                            </div>
                </div>
                <div class="row justify-content-center pt-3 pb-5">
                        <div class="col-3">
                                <div class="input-group">
                                        <select class="custom-select" id="fileType_2">
                                          <option selected>File</option>
                                          <option value="SVG">SVG</option>
                                          <option value="PNG">PNG</option>
                                          <option value="PDF">PDF</option>
                                        </select>
                                        <div class="input-group-append">
                                                    <a id="dendownload" class="btn btn-primary" style="color: white;">Download</a>
                                        </div>
                                </div>
            
                        </div>
                    </div>
                        <!--
                <div class="download text-center">
                    <select id='fileType_2'>
                        <option>SVG</option>
                        <option>PNG</option>
                        <option>PDF</option>
                    </select>
                    <a class="btn btn-primary btn-sm text-center" id="denDownload" download="circDraw.svg">Download</a>
                </div>-->

                <h2 id="isoform" data-toc-text="Isoform plot">circRNA isoforms on chromosome region</h2>
                    <svg id="svg" width="800" height="500" class="svg"></svg>

                    <div class="row justify-content-center pt-3">
                    <div class="col-3">
                            <div class="input-group">
                                    <select class="custom-select" id="fileType_1">
                                      <option selected>File</option>
                                      <option value="SVG">SVG</option>
                                      <option value="PNG">PNG</option>
                                      <option value="PDF">PDF</option>
                                    </select>
                                    <div class="input-group-append">
                                      <button class="btn btn-primary btn-sm" id="drawdownload" type="button">Download</button>
                                    </div>
                            </div>
                    </div>
                </div>

                    <!--<div class="download text-center">
                        <select id='fileType_1'>
                            <option>SVG</option>
                            <option>PNG</option>
                            <option>PDF</option>
                        </select>
                        <button class="btn btn-primary btn-sm text-center" id="drawDownload" download="circDraw.svg">Download</button>
                    </div>-->
                    <!-- Choose to view which chromosome -->
                    <!-- End of the chromosome option -->              
                    
                    <div class="extra-controls mb-1 mt-3">
                        <p class="inlineText">Name:</p>
                        <p id="geneNameSelect" class="inlineText"></p>
                        <p class="inlineText">Chr:</p>
                        <p id="chrSelector" class="inlineText">0</p>
                        <p class="inlineText">Start:</p>
                        <p id="js-input-from" class="inlineText">0</p>
                        <p class="inlineText">End:</p>
                        <p id="js-input-to" class="inlineText">0</p>
                    </div>

                    <div class="positionBotton mb-5">
                            <button class="btn btn-primary btn-sm text-center" id="previous">&laquo; Previous Gene</button>
                            <button class="btn btn-primary btn-sm text-center" id="next">Next Gene &raquo;</button>
                        </div>

                    <h2 id="BaTable">circRNA Table</h2>
                    <div class="row justify-content-center">
                        <div class="col-8">
                            <div id="table"></div>
                        </div>
                    </div>

            </div>
        </div>
    </div>
</section>

{% endblock %}


{% block otherJS %}
{% load staticfiles %}
{% csrf_token %}
<!-- Outside js -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.2.3/js/tabulator.js"></script>
<script src="https://cdn.bootcss.com/echarts/4.1.0.rc2/echarts-en.common.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.5.1/snap.svg-min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js" integrity="sha384-NaWTHo/8YCBYJ59830LTz/P4aQZK1sS0SneOgAvhsIl3zBu8r9RevNg5lHCHAuQ/"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/canvg/1.4/rgbcolor.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvg@2.0.0-beta.0/dist/browser/canvg.min.js"></script>

<!-- Enbed varibles -->

<!-- Custom js for this template -->
<script src="{% static 'tools/js/ion.rangeSlider.min.js' %}" type="text/javascript"></script>
<script src="{% static 'tools/js/denChrPlot.js' %}" type="text/javascript"></script>
<script src="{% static 'tools/js/drawCirc.js' %}" type="text/javascript"></script>
<script src="{% static 'tools/js/agency.min.js' %}" type="text/javascript"></script>
<script src="{% static 'tools/js/linechart.js' %}" type="text/javascript"></script>
<script src="{% static 'tools/js/download.js' %}" type="text/javascript"></script>

<link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.2.3/css/bootstrap/tabulator_bootstrap4.min.css"/>
<!-- add after bootstrap.min.js -->
<script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script>
<script>
        $(function() {
            var navSelector = "#toc";
            var $myNav = $(navSelector);
            Toc.init($myNav);
            $("body").scrollspy({
              target: navSelector
            });
          });

          var nestedData = [
          {id:1, make:"Ford", model:"focus", reg:"P232 NJP", color:"white", serviceHistory:[
             {date:"01/02/2016", engineer:"Steve Boberson", actions:"Changed oli filter"},
             {date:"07/02/2017", engineer:"Martin Stevenson", actions:"Break light broken"},
          ]},
          {id:2, make:"BMW", model:"m3", reg:"W342 SEF", color:"red", serviceHistory:[
             {date:"22/05/2017", engineer:"Jimmy Brown", actions:"Aligned wheels"},
             {date:"11/02/2018", engineer:"Lotty Ferberson", actions:"Changed Oil"},
             {date:"04/04/2018", engineer:"Franco Martinez", actions:"Fixed Tracking"},
          ]},
      ]
      var printIcon = function(cell, formatterParams){ //plain text value
        return "<i class='fas fa-link'></i>";
    };

      var table = new Tabulator("#table", {
        height:"500px",
        layout:"fitColumns",
        resizableColumns:false,
        data:nestedData,
        columns:[
            {title:"Exon Name", field:"make"},
            {title:"Start", field:"model"},
            {title:"End", field:"reg"},
            {title:"Source Gene", field:"color"},
        ],
        rowFormatter:function(row){
            //create and style holder elements
           var holderEl = document.createElement("div");
           var tableEl = document.createElement("div");
    
           holderEl.style.boxSizing = "border-box";
           holderEl.style.padding = "10px 30px 10px 10px";
           holderEl.style.borderTop = "1px solid rgba(0,0,0,.1)";
           holderEl.style.borderBotom = "1px solid rgba(0,0,0,.1)";
           holderEl.style.background = "#fff";
    
           tableEl.style.border = "1px solid rgba(0,0,0,.1)";
    
           holderEl.appendChild(tableEl);
    
           row.getElement().appendChild(holderEl);
    
           var subTable = new Tabulator(tableEl, {
               layout:"fitColumns",
               data:row.getData().serviceHistory,
               columns:[
               {title:"Mod Type", field:"date", sorter:"date"},
               {title:"Start", field:"engineer"},
               {title:"End", field:"actions"},
               {title:"Disease", field:""},
               {formatter:printIcon, width:40, align:"center", cellClick:function(e, cell){alert("Printing row data for: " + cell.getRow().getData().name)}}
               ]
           })
        },
    });
</script>

{% endblock %}